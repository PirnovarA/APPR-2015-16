---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Andraž Pirnovar"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
always_allow_html: yes
---

```{r, echo=FALSE}
type <- knitr::opts_knit$get("rmarkdown.pandoc.to")
```

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Analiza plač v ZDA. Zanima me, kateri poklici zaslužijo največ, ter kateri najmanj. Zanima me tudi, v kateri zvezni državi je najugodneje živeti, glede na povprečni dohodek na prebivalca in povprečni dohodek na gospodinjstvo ter družino. Imel bom tudi primerjavo povprečnih plač v zveznih državah po letih.   

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Uvozil sem podatke z Ameriškega statističnega urada (http://www.bls.gov/bls/proghome.htm) v .CSV obliki. To sem ločil na prikaz urnih ter letnih plač ter število zaposlenih v posameznem poklicu.   
Druge podatke, o povprečnih plačah v zveznih državah, sem pridobil v obliki HTML in sicer iz Wikipedije in spletne strani infoplease.   
Vse podane plače so v $.   

### National in state

Podatke sem pridobil za 14 let in sicer za vsaki dve leti (2014, 2012, 2012, 2010, 2008, 2006, 2004, 2002). Starejši podatki so se od novih razlikovali, predvsem v imenih stolpcev, prav tako pa tudi v predoločenih vredostih maksimalne plače. Kot sem kasneje, med urejanjem opazil, nisi vsi poklici, ali obstajali, ali bolj verjetno, niso bili popisani oz. dani v isto kategorijo, tako da bo med analizo in graficnim prikazom kdaj mogoce opaziti kaksno anomalijo, posledico danih podatkov.    

Iz vseh podatkov sem si izbral samo urne plače, ne pa tudi letnih, kajti razlike v rezultatih bi bile minimalne, če sploh. V svojo tabelo sem shranil tudi podatke o zaposlitvi (v povezavi s poklicem, letom in zvezno državo), da se ne bi ponavljali.   


```{r state_razp, echo=FALSE}
kable(head(state))
```


Stolpci v podatkih _state_ in _national_ pomenijo:

1. __State__: Samo v podatkih "state", povejo zvezno državo pripadajočega poklica

2. __Occupation__: Poklic, kateremu pripadajo vsi drugi podatki v vrstici

3. __Hourly_mean__: Povprečna urna plača za ta poklic

4. __H_PCT10 - H_PCT90__: Plača po percentilih, H_median je mediana (vse se seveda nanaša na urne plače)

5. __Year__: Leto, v katerem so poklici imeli to plačo

Podatki v tidy data pa zgledajo takole:   

```{r national_razp, echo=FALSE}
kable(head(national_tidy))

kable(head(state_tidy))
```

1. __State__: Pove zvezno državo, v kateri je poklic (samo pri tabeli state)

2. __Occupation__: Poklic

3. __Year__: Leto merjenja

4. __Type__: Pove, kateri "tip" plače gledamo oz. katero meritev (povprečje, percentil) imamo

5. __Wage__: Plača


### Per_capita2

Tabela per_capita2 (dobljena iz Wikipedije v HTML) prikazuje primerjavo med zveznimi državami glede na zaslužek per capita, povprečnim dohodkom gospodinjstva in dohodkom družine, zraven pa so še podatki o št. prebivalcev v državi in številu gospodinjstev.  
Te tabele nisem kaj preveč urejal, razen, da sem spremenil vrednosti v "numeric", odstranil simbole in vejice, ipd. in jo dal v obliko tidy data    


```{r percapita2, echo=FALSE}
kable(head(per_capita2_tidy))
```

1. __State__: V kateri zvezni državi gledamo

2. __Population__: Število prebivalcev v tisti zvezni državi

3. __Number__ of households: Število gospodinjstev

4. __Wage__: Povprečna plača v zvezni državi

### Per_capita

Tabela per_capita prikazuje, že spet, zvezne države, urejene po povprečnih plačah. A tokrat imamo plače za več različnih let, prirejene inflaciji. Tabelo sem prav tako dobil iz interneta, v obliki HTML. Sedaj je v obliki tidy data.   

```{r percapita, echo=FALSE}
kable(head(per_capita_tidy))
```

1. __State__: Gledana zvezna država

2. __Year__: Leto meritev

4. __Wage__: Povprečna plača v tisti zv. državi v tistem letu


```{r lineplot, fig.align='center', echo=FALSE, fig.cap='Sprememba povprecnih plac v zveznih drzavah'}

graf_top_5

```


Spodnji graf prikazuje spremembo povprečne plače glede na razne parametre. Rdeča debela črta prikazuje glajeno spremembo povprečne plače, glede na vse prebivalce ZDA, medtem ko modra črta prikazuje glajeno spremembo povprečne plače glede na povprečne plače v posameznih zveznih državah. Kot je razvidno, in pričakovano, je District of Columbia (DC) zelo nad povprečjem, kar je posledica, da tam živijo v veliki večini politiki, lobisti ipd., kar povečuje standard.   
Kar pa še lahko opazimo, je to, da očitno v revnejših zveznih državah živi manj ljudi kot v bogatejših, saj je modra krivulja pod rdečo.

```{r povp_placa_graf, echo=FALSE}
switch (type,
  latex = graf_national_tidy_mean,
  html=graf_national_tidy_mean
)
```   

Na spodnjem zemljevidu je prikazano razmerje med posameznimi zveznimi državami in povprečnimi plačami. Osnovne barve so za leto 2014, a s "preletom" miške vidimo še povprečne plače v preteklih letih.   


```{r povp_placa_zemljevid, echo=FALSE}
switch (type,
  latex = graf_povp_placa_state_2014,
  html=graf_povp_placa_state_plotly
)
```  

Kar lahko vidimo, je to, da so najrevnejše države znotraj ZDA, ter proti jugu. To je logična posledica pomankanja naravnih virov, prav tako pa je možno opaziti korelacijo med politično afiliacijo (demokrati/republikanci) in povprečno plačo.

```{r volitve, echo=FALSE}
volitve_2012
```

